<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>しろけぷ発言まとめ - グラフ</title>
</head>
<body>
	<script src="style.js" async></script>
	<style>
		:root{background-color:#000;}
		img{display:inline-block;max-width:640px;margin:4px;vertical-align:top;}
	</style>
	<script>
		const main=()=>fetch('main.json').then(r=>r.json()).then(x=>{
				month(x);
				[
					[x.month,(y,i)=>[y,x.data.reduce((a,z)=>a+(z.month==i),0)],'月別 発言数合計'],
					[x.member,(y,i)=>[y.name,x.data.reduce((a,z)=>a+(z.member==i),0)],'発言数合計'],
					[x.tag,(y,i)=>[y,x.data.reduce((a,z)=>a+z.tag.includes(i),0)],'タグ別 発言数合計']
				].forEach(async y=>{
					y[1]=y[0].map(y[1]);
					const c=document.createElement('canvas'),
						ctx=c.getContext('2d'),
						img=document.createElement('img');
					c.width=1024;c.height=c.width*.5625;
					const w=c.width/y[0].length,
						h=c.height/Math.max(...y[1].map(z=>z[1]))*.9;
					ctx.imageSmoothingEnabled=false;
					ctx.textAlign='center';
					ctx.font='24px sans-serif';
					ctx.fillStyle='#222';
					ctx.fillRect(0,0,c.width,c.height);
					y[1].forEach((z,i)=>{
						ctx.fillStyle='#68f';
						ctx.fillRect((i+.2)*w,c.height-z[1]*h,w*.6,z[1]*h);
						ctx.fillStyle='#fff';
						ctx.fillText(z[0],(i+.5)*w,c.height-4,w*.6);
						ctx.fillText(z[1]+'件',(i+.5)*w,c.height-36,w*.6);
					});
					ctx.font='32px sans-serif';
					ctx.fillText(y[2],c.width*.5,48,c.width);
					img.src=c.toDataURL();
					document.body.appendChild(img);
				});
			}).catch(llog);
		if(typeof urlq=='undefined')document.addEventListener('styexe',main);else main();
	</script>
</body>
</html>
