<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>しろけぷ発言まとめ - ホーム</title>
	<link rel="stylesheet" href="https://mcbeeringi.github.io/src/style.css">
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<script src="bg.js" async></script>
	<div class="title">
		<h1>しろけぷ発言まとめ</h1>
		<div id="breaf">読み込み中…</div>
	</div>
	<hr>
	<div id="wrap" class="stuff">
		<div><h3>すべて</h3><hr><ul>
			<li><a href="viewer.html?subt=すべて">すべて</a></li>
			<li><a href="viewer.html" id="rand">おまかせ</a></li>
			<li><a href="https://mcbeeringi.github.io/apps/jsrun.html#document.body.insertAdjacentHTML%28'beforeend'%2C'%3Ch1%3E%E3%81%97%E3%82%8D%E3%81%91%E3%81%B7%E6%A4%9C%E7%B4%A2%3C%2Fh1%3E%3Chr%3E%3Cinput%20id%3D%22inp%22%20class%3D%22input%22%20style%3D%22width%3A100%25%3B%22%20placeholder%3D%22please%20wait...%22%20disabled%3E%3Cpre%20id%3D%22out%22%20style%3D%22overflow%3Aauto%3B%22%3E%3C%2Fpre%3E'%29%3B%0Aconst%20root%3D'https%3A%2F%2Fmcbeeringi.github.io%2Fshirokepu%2F'%3B%0Afetch%28root%2B'main.json'%29.then%28x%3D%3Ex.json%28%29%29.then%28x%3D%3E%7B%0A%09x.tmp%3Dx.data.map%28%28y%2Ci%29%3D%3E%5Bi%2C%60%24%7By.no%7D%20%24%7Bx.member%5By.member%5D.name%7D%2020%24%7BMath.floor%28y.date%2F1e4%29%251e2%7D%E5%B9%B4%20%24%7BMath.floor%28y.date%2F1e2%29%251e2%7D%E6%9C%88%20%24%7By.date%251e2%7D%E6%97%A5%20%24%7By.tag.map%28z%3D%3Ex.tag%5Bz%5D%29.join%28'%20'%29%7D%20%24%7By.data%7D%20%24%7By.desc%7D%60%5D%29%3B%0A%09Object.assign%28inp%2C%7Bplaceholder%3A'search...'%2Cdisabled%3Afalse%2Coninput%3A%28%29%3D%3E%7B%0A%09%09const%20s%3Dinp.value.split%28%2F%5B%20%E3%80%80%5D%2B%2F%29.reduce%28%28a%2Cy%29%3D%3Ea.filter%28z%3D%3Ez%5B1%5D.includes%28y%29%29%2Cx.tmp%29%3B%0A%09%09out.textContent%3D''%3B%0A%09%09out.insertAdjacentHTML%28'beforeend'%2C%60%3Ca%20href%3D%22%24%7Broot%7Dviewer.html%3Fsubt%3D%24%7BencodeURIComponent%28'%E6%A4%9C%E7%B4%A2%E4%B8%80%E8%A6%A7%3A%20'%2Binp.value%29%7D%26i%3D%24%7Bs.map%28y%3D%3Ex.data%5By%5B0%5D%5D.no%29.join%28'%2B'%29%7D%22%3E%E4%B8%80%E8%A6%A7%E8%A1%A8%E7%A4%BA%3C%2Fa%3E%5Cn%60%2Bs.map%28y%3D%3E%7B%0A%09%09%09y%3Dx.data%5By%5B0%5D%5D%3B%0A%09%09%09return%60%3Ca%20href%3D%22%24%7Broot%7Dviewer.html%3Fsubt%3D%24%7BencodeURIComponent%28'%E6%A4%9C%E7%B4%A2%E7%B5%90%E6%9E%9C%3A%20'%2Binp.value%29%7D%26m%3D1%26i%3D%24%7By.no%7D%22%3E%24%7B%28''%2By.no%29.padStart%283%2C'%20'%29%7D%3A%20%24%7By.data%7D%3C%2Fa%3E%60%3B%0A%09%09%7D%29.join%28'%5Cn'%29%29%3B%0A%09%7D%7D%29%3B%0A%7D%29%3B">検索 (仮)</a></li>
			<br>
			<li><a href="https://utareyu.github.io/app/shirokepuJSONtool/shirokepuJSONtool.html">入力補助</a></li>
			<li style="opacity:.05;"><a href="https://mcbeeringi.github.io/apps/jsrun.html#%28async%20x%3D%3E%7B%0A%09document.body.textContent%3D'%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF%E4%B8%AD...'%3B%0A%09x%3Dawait%28await%20fetch%28'https%3A%2F%2Fmcbeeringi.github.io%2Fshirokepu%2Fmain.json'%29%29.json%28%29%3B%0A%09const%20selfx%3Dy%3D%3Ey.map%28%28z%2Ci%29%3D%3E%60%3Coption%20value%3D%22%24%7Bi%7D%22%3E%24%7Bz%7D%3C%2Foption%3E%60%29.join%28''%29%2C%0A%09%09d%3Dnew%20Date%28%29%2C%0A%09%09TA%3DFunction%28await%28await%20fetch%28'https%3A%2F%2Fmcbeeringi.github.io%2Fta%2Fta.js'%29%29.text%28%29%2B'return%20TA%3B'%29%28%29%2C%0A%09%09main%3D%28%29%3D%3E%7B%0A%09%09%09wrap.insertAdjacentHTML%28'afterbegin'%2C%60%3Cdiv%3E%0A%09%09%09%09%3Clabel%3E%E3%80%80%E7%95%AA%E5%8F%B7%3A%20%3Cinput%20type%3D%22number%22%20id%3D%22no%22%20class%3D%22input%22%20value%3D%22%24%7B%28Math.max%280%2C...Array.from%28wrap.children%2Cy%3D%3E%2By.querySelectorAll%28'.input'%29%5B0%5D.value%29%29%7C%7CMath.max%28...x.data.map%28y%3D%3Ey.no%29%29%29%2B1%7D%22%3E%3C%2Flabel%3E%3Cbr%3E%0A%09%09%09%09%3Clabel%3E%E7%99%BA%E8%A8%80%E8%80%85%3A%20%3Cselect%20class%3D%22input%22%3E%24%7Bselfx%28x.member.map%28y%3D%3Ey.name%29%29%7D%3C%2Fselect%3E%3C%2Flabel%3E%3Cbr%3E%0A%09%09%09%09%3Clabel%3E%E3%80%80%E6%97%A5%E4%BB%98%3A%20%3Cinput%20type%3D%22date%22%20class%3D%22input%22%20value%3D%22%24%7Bd.getFullYear%28%29%7D-%24%7B%28d.getMonth%28%29%2B1%2B''%29.padStart%282%2C'0'%29%7D-%24%7B%28d.getDate%28%29%2B''%29.padStart%282%2C'0'%29%7D%22%3E%3C%2Flabel%3E%3Cbr%3E%0A%09%09%09%09%3Clabel%3E%E3%80%80%E3%82%BF%E3%82%B0%3A%20%3Cselect%20multiple%20class%3D%22input%22%20style%3D%22vertical-align%3Atop%3B%22%3E%24%7Bselfx%28x.tag%29%7D%3C%2Fselect%3E%3C%2Flabel%3E%3Cbr%3E%0A%09%09%09%09%3Clabel%3E%E3%80%80%E7%99%BA%E8%A8%80%3A%20%3Cinput%20class%3D%22input%22%20style%3D%22width%3A100%25%3Bmax-width%3A256px%3B%22%3E%3C%2Flabel%3E%3Cbr%3E%0A%09%09%09%09%3Clabel%3E%E3%80%80%E8%AA%AC%E6%98%8E%3A%20%3Ctextarea%20class%3D%22input%22%20style%3D%22vertical-align%3Atop%3Bwidth%3A100%25%3Bmax-width%3A512px%3B%22%3E%3C%2Ftextarea%3E%3C%2Flabel%3E%3Cbr%3E%0A%09%09%09%09%3Cbutton%20onclick%3D%22this.parentNode.remove%28%29%3B%22%20class%3D%22button%22%3E%20%E5%89%8A%E9%99%A4%20%3C%2Fbutton%3E%0A%09%09%09%09%3Chr%3E%0A%09%09%09%3C%2Fdiv%3E%60%29%3B%0A%09%09%09TA.editor%28wrap.children%5B0%5D.querySelectorAll%28'.input'%29%5B5%5D%29%3B%0A%09%09%7D%2C%0A%09%09esc%3Dx%3D%3Ex.replace%28%2F%28%5B%5C%5C%5C%2F%5D%29%2Fg%2C'%5C%5C%241'%29%3B%0A%09document.body.textContent%3D''%3B%0A%09document.body.insertAdjacentHTML%28'beforeend'%2C%60%3Ch1%3E%E3%81%97%E3%82%8D%E3%81%91%E3%81%B7%E5%85%A5%E5%8A%9B%E8%A3%9C%E5%8A%A9%3C%2Fh1%3E%3Chr%3E%3Cbutton%20id%3D%22add%22%20class%3D%22button%22%3E%20%EF%BC%8B%20%3C%2Fbutton%3E%20%3Cbutton%20id%3D%22exe%22%20class%3D%22button%22%3E%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%B3%E3%83%94%E3%83%BC%E3%81%97%E3%81%A6%E7%B7%A8%E9%9B%86%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E9%96%8B%E3%81%8F%3C%2Fbutton%3E%3Chr%3E%3Cdiv%20id%3D%22wrap%22%3E%3C%2Fdiv%3E%60%29%3B%0A%09add.onclick%3Dmain%3Bmain%28%29%3B%0A%09exe.onclick%3D%28%29%3D%3E%7B%0A%09%09navigator.clipboard.writeText%28%0A%09%09%09%5B...wrap.children%5D.map%28y%3D%3E%7B%0A%09%09%09%09y%3Dy.querySelectorAll%28'.input'%29%3B%0A%09%09%09%09return%60%5Cn%5Ct%5Ct%7B%22no%22%3A%24%7By%5B0%5D.value.padStart%283%2C'%20'%29%7D%2C%20%22member%22%3A%24%7By%5B1%5D.value%7D%2C%20%22date%22%3A%24%7B%5B2%2C3%2C5%2C6%2C8%2C9%5D.reduce%28%28a%2Cz%29%3D%3Ea%2By%5B2%5D.value%5Bz%5D%2C''%29%7D%2C%20%22tag%22%3A%5B%24%7B%5B...y%5B3%5D.children%5D.reduce%28%28a%2Cz%29%3D%3Ez.selected%3F%5B...a%2C%2Bz.value%5D%3Aa%2C%5B%5D%29%7D%5D%2C%20%22data%22%3A%22%24%7Besc%28y%5B4%5D.value%29%7D%22%2C%20%22desc%22%3A%22%24%7Besc%28y%5B5%5D.value.replace%28%2F%5Cn%2Fg%2C'%20'%29%29%7D%22%7D%2C%60%3B%0A%09%09%09%7D%29.join%28''%29%0A%09%09%29.then%28%28%29%3D%3E%7B%0A%09%09%09location.href%3D'https%3A%2F%2Fgithub.com%2FMcbeEringi%2Fshirokepu%2Fedit%2Fmain%2Fmain.json'%3B%0A%09%09%7D%29%3B%0A%09%7D%3B%0A%7D%29%28%29%3B">人力補助</a></li>
		</ul></div>
	</div>
	<script src="com.js"></script>
	<script>
		fetch('main.json').then(x=>x.json()).then(x=>{
			x.data=x.data.map(y=>[y,Math.floor(y.date*.01)]);
			x.month=[...new Set(x.data.map(y=>y[1]))];
			x.tmp=Object.fromEntries(x.month.map((y,i)=>[y,i]));
			x.data=x.data.map(y=>({...y[0],month:x.tmp[y[1]]}));
			x.month=x.month.map(y=>`20${Math.floor(y*.01)}年${y%100}月`);
			x.tmp=x.data.reduce((a,y)=>{
				a.month[y.month].push(y.no);
				a.member[y.member].push(y.no);
				y.tag.forEach(z=>a.tag[z].push(y.no));
				return a;
			},Object.fromEntries(['month','member','tag'].map(y=>[y,new Array(x[y].length).fill().map(()=>[])])));
			wrap.insertAdjacentHTML('beforeend',
					[['月別','month',''],['発言者別','member','発言者:'],['タグ別','tag','タグ:']]
						.map(y=>[y[0],x[y[1]].map((z,i)=>`<li><a href="viewer.html?${urlq_({i:x.tmp[y[1]][i],subt:[y[2]+(z.name||z)]})}">${z.name||z} (${x.tmp[y[1]][i].length}件)</a></li>`)])
						.map(y=>`<div><h3>${y[0]}</h3><hr><ul>${y[1].join('')}</ul></div>`).join('')
			);

			const draw=()=>Promise.all([['month','月別 発言数合計'],['member','発言数合計'],['tag','タグ別 発言数合計']].map((y,i)=>new Promise(f=>{
				const sty=getComputedStyle(document.body),
					h=64,
					arr=x[y[0]].map((z,i)=>[z.name||z,x.tmp[y[0]][i].length]),
					c=Object.assign(document.createElement('canvas'),{width:1024,height:h*(arr.length+1)}),
					ctx=Object.assign(c.getContext('2d'),{textAlign:'left',font:'32px sans-serif',fillStyle:sty.getPropertyValue('--bc')}),
					w=(c.width-h)/Math.max(...arr.map(z=>z[1]));
				ctx.fillRect(0,0,c.width,c.height);
				arr.forEach((z,j)=>{
					j++;
					ctx.fillStyle=sty.getPropertyValue('--graph');ctx.fillRect(0,h*(j+.1),z[1]*w,h*.8);
					j=h*(j+.8);
					ctx.fillStyle=sty.getPropertyValue('--fc');ctx.fillText(z[0],0,j,h*2);ctx.fillText(z[1]+'件',h*3,j);
				});
				Object.assign(ctx,{textAlign:'center',font:'48px sans-serif'});ctx.fillText(y[1],c.width*.5,h*.8);
				c.toBlob(b=>{
					const img=document.createElement('img');
					img.onload=()=>URL.revokeObjectURL(img.src);img.style.cssText='max-width:480px;width:100%;border-radius:4px;';
					img.src=URL.createObjectURL(b);f(img);
				});
			}))).then(y=>{
				if(window.graphs)graphs.remove();
				const e=document.createElement('div');e.id='graphs';
				e.insertAdjacentHTML('beforeend','<h3>グラフ一覧</h3><hr>')
				y.forEach(z=>e.appendChild(z));
				wrap.appendChild(e);
			});
			draw();window.matchMedia('(prefers-color-scheme:light)').addEventListener('change',draw);

			breaf.textContent='';
			breaf.insertAdjacentHTML('beforeend',table(['最終追加日:',n2d(x.data[x.data.length-1].date).join('/')],['発言総数:',x.data.length]));
			rand.onclick=e=>{e.preventDefault();Object.assign(document.createElement('a'),{href:`viewer.html?m=1&i=${x.data[Math.floor(Math.random()*x.data.length)].no}`}).click();};
		}).catch(llog);
	</script>
</body>
</html>
