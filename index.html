<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<title>しろけぷ発言まとめ - ホーム</title>
</head>
<body>
	<script src="style.js" async></script>
	<div class="flex fw jcsa">
		<h1>しろけぷ発言まとめ</h1>
		<table>
			<tr><td class="tar op">最終追加日: </td><td id="latest">読み込み中…</td></tr>
			<tr><td class="tar op">発言総数: </td><td id="total">読み込み中…</td></tr>
		</table>
	</div>
	<hr>
	<div class="flex fw">
		<div>
			<h3>すべて</h3>
			<ul>
				<li><a href="viewer.html?m=list">すべて (<span id="total_">読み込み中…</span>件)</a></li>
				<li><a href="viewer.html?m=item&r=1">おまかせ</a></li>
			</ul>
		</div>
		<div><h3>月別</h3><ul id="month">読み込み中…</ul></div>
		<div><h3>発言者別</h3><ul id="member">読み込み中…</ul></div>
		<div><h3>タグ別</h3><ul id="tag">読み込み中…</ul></div>
	</div>
	<pre>viewer.html query parameter

m	'list' or 'item'
i	No. numbers
r	choose randomly from i (0==all,-n==all-n)</pre>
	<script>
		const main=()=>fetch('main.json').then(r=>r.json()).then(x=>{
				latest.textContent=n2d(x.data[x.data.length-1].date).join('/');
				total_.textContent=total.textContent=x.data.length;
				x.tmp=x.data.reduce((a,y)=>{
						a.member[y.member].push(y.no);
						y.tag.forEach(z=>a.tag[z].push(y.no));
						const m=String(y.date).substr(0,4);
						if(a.month[m])a.month[m].push(y.no);else a.month[m]=[y.no];
						return a;
					},{month:{},member:new Array(x.member.length).fill().map(()=>[]),tag:new Array(x.tag.length).fill().map(()=>[])});
				month.textContent='';
				month.insertAdjacentHTML('beforeend',
					Object.entries(x.tmp.month).map(y=>`<li><a href="viewer.html?m=list&i=${y[1].join('+')}">20${y[0].substr(0,2)}/${y[0].substr(2,2)} (${y[1].length}件)</a></li>`).join('')
				);
				member.textContent='';
				member.insertAdjacentHTML('beforeend',x.member.map((y,i)=>`<li><a href="viewer.html?m=list&i=${x.tmp.member[i].join('+')}">${y.name} (${x.tmp.member[i].length}件)</a></li>`).join(''));
				tag.textContent='';
				tag.insertAdjacentHTML('beforeend',x.tag.map((y,i)=>`<li><a href="viewer.html?m=list&i=${x.tmp.tag[i].join('+')}">${y} (${x.tmp.tag[i].length}件)</a></li>`).join(''));
			}).catch(llog);
		if(typeof urlq=='undefined')document.addEventListener('styexe',main);else main();
	</script>
</body>
</html>
