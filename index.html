<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>しろけぷ発言まとめ - ホーム</title>
</head>
<body>
	<script src="style.js" async></script>
	<div class="flex fw jcsa">
		<h1>しろけぷ発言まとめ</h1>
		<table>
			<tr><td class="tar op">最終追加日: </td><td id="latest">読み込み中…</td></tr>
			<tr><td class="tar op">発言総数: </td><td id="total">読み込み中…</td></tr>
		</table>
	</div>
	<hr>
	<div class="flex fw top" id="wrap">
		<div>
			<h3>すべて</h3>
			<ul>
				<li><a href="viewer.html">すべて</a></li>
				<li><a id="rand">おまかせ</a></li>
				<li><a href="graph.html">グラフ</a></li>
			</ul>
		</div>
	</div>
	<script>
		const main=()=>fetch('main.json').then(r=>r.json()).then(x=>{
				month(x);
				latest.textContent=n2d(x.data[x.data.length-1].date).join('/');
				total.textContent=x.data.length;
				setInterval(()=>rand.href='viewer.html?m=1&i='+x.data[Math.floor(Math.random()*x.data.length)].no,500);
				x.tmp=x.data.reduce((a,y)=>{
					a.month[y.month].push(y.no);
					a.member[y.member].push(y.no);
					y.tag.forEach(z=>a.tag[z].push(y.no));
					return a;
				},{month:new Array(x.month.length).fill().map(()=>[]),member:new Array(x.month.length).fill().map(()=>[]),tag:new Array(x.month.length).fill().map(()=>[])});
				wrap.insertAdjacentHTML('beforeend',
					[['month','月別',''],['member','発言者別','発言者:'],['tag','タグ別','タグ:']]
					.map(y=>[x[y[0]].map((z,i)=>`<li><a href="viewer.html?i=${x.tmp[y[0]][i].join('+')}&subt=${y[2]}${z.name||z}">${z.name||z} (${x.tmp[y[0]][i].length}件)</a></li>`),y[1]])
					.map(y=>`<div><h3>${y[1]}</h3><ul>${y[0].join('')}</ul></div>`).join('')
				);
			}).catch(llog);
		if(typeof urlq=='undefined')document.addEventListener('styexe',main);else main();
	</script>
</body>
</html>
